#IN THE NAME OF ALLAH
#EOF in phosphorene channel 
echo both 


# settings

variable	q equal 60
variable	area equal 1776.58272e-20
variable       sigma equal ${q}*1.60217662e-19/(2*${area})
print          "sigma: ${sigma} "
variable	T equal 300
variable       Ex equal 0.0
variable       Ey equal 0.025
variable       P_charge equal -${q}/960



boundary     p  p  f
units           real
neigh_modify    delay 0 every 1

log             log-${q}na-${T}K-${Ex}x-${Ey}y.log


atom_style      full
bond_style      harmonic
angle_style     charmm

read_data       EOF-${q}na.data

pair_style      lj/charmm/coul/long 8 11
pair_coeff      1 1	0.0      0.000 #H
pair_coeff      2 2 	0.1553   3.165 #O
pair_coeff      1 2 	0.0      0.000 # H-O
pair_coeff      3 3 	0.0148   2.575 #SOD
pair_coeff      4 4 	0.106    4.448 #CLA
pair_coeff      5 5 	0.400    3.330 #P
pair_coeff      6 6 	0.400    3.330 #P

pair_modify     mix arithmetic
kspace_style    pppm 1e-4
kspace_modify slab 3.0



special_bonds   charmm

group           water type 1 2
group           channel type 5 6
group           flow type 1 2 3 4
group           H  type  1
group           O  type  2
group           NA type  3
group           CL type  4


set group channel charge ${P_charge}

velocity        flow create $T 12345678 dist uniform
delete_atoms    overlap 1 flow channel mol yes


compute Temp flow temp
compute Press all pressure Temp  ke pair bond virial
compute Press1 all pressure Temp  virial
compute Press2 all pressure Temp  ke 


thermo          10000
thermo_style  custom step temp c_Temp lx ly lz cpu density  c_Press c_Press1 c_Press2

fix             setforce1 channel setforce 0 0 0
fix             Spring channel spring/self  200
fix             2 water shake 1e-6 500 0 m 1.0 a 1

timestep        0.001
fix             1 flow nvt temp $T $T 100


dump            1 all custom 25000 rerun-${q}na-${T}K-${Ex}x-${Ey}y.txt id x y z vx vy vz fy fx fz #rerun command
dump_modify     1 sort id
dump            2 all xyz/gz 25000 DUMP-${q}na-${T}K-${Ex}x-${Ey}y.xyz.gz
dump            3 all atom 25000 solvate-${q}na-${T}K-${Ex}x-${Ey}y.lammpstrj

run             50000
unfix      1

timestep  0.5
fix       FixNVT1 flow nvt temp $T $T 100

thermo   50000
thermo_style custom step temp  c_Temp press density

run 20000

############################################################## equilibrium #####################################
reset_timestep 0

timestep  2

compute		CChunkO  O   chunk/atom bin/1d z 0 0.1
compute		CChunkH  H   chunk/atom bin/1d z 0 0.1
compute		CChunkNA  NA  chunk/atom bin/1d z 0 0.1
compute		CChunkCL  CL  chunk/atom bin/1d z 0 0.1
compute		CChunkWATER  water   chunk/atom bin/1d z 0 0.1

fix   	        FChunkO  O   ave/chunk 1 100000 100000 CChunkO  density/mass density/number temp norm sample file O-${q}na-${T}K-${Ex}x-${Ey}y.density
fix             FChunkH  H   ave/chunk 1 100000 100000 CChunkH  density/mass density/number temp norm sample file H-${q}na-${T}K-${Ex}x-${Ey}y.density
fix             FChunkNA  NA  ave/chunk 1 100000 100000 CChunkNA  density/mass density/number temp norm sample file NA-${q}na-${T}K-${Ex}x-${Ey}y.density
fix             FChunkCL  CL  ave/chunk 1 100000 100000 CChunkCL  density/mass density/number temp norm sample file CL-${q}na-${T}K-${Ex}x-${Ey}y.density
fix             FChunkWater  water  ave/chunk 1 100000 100000 CChunkWATER  density/mass density/number temp norm sample file WATER-${q}na-${T}K-${Ex}x-${Ey}y.density


run 500000 #1ns


############################################################## efield #####################################


dump            33 all  xyz  100000  all-efield-${q}na-${T}K-${Ex}x-${Ey}y.xyz             #5000 all-efield.xyz
dump            4 flow xyz  100000  NoWater-efield-${q}na-${T}K-${Ex}x-${Ey}y.xyz          #5000 NoWater-efield.xyz

compute cc1 flow chunk/atom bin/1d z 0.0 0.5
compute cc1f flow chunk/atom bin/1d z 0.0 1
compute cc1CL CL chunk/atom bin/1d z 0.0 0.5
compute cc1NA NA chunk/atom bin/1d z 0.0 0.5
compute cc1Water water chunk/atom bin/1d z 0.0 0.5

#fix 8 flow ave/chunk 500000 1 500000 cc1 vx vy file vel-${q}na-${T}K-${Ex}x-${Ey}y.profile #
fix 8 flow ave/chunk 1 2000000 2000000 cc1 vx vy norm sample file vel-${q}na-${T}K-${Ex}x-${Ey}y.profile
fix 80 flow ave/chunk 1 2000000 2000000 cc1f vx vy norm sample file vel-${q}na-${T}K-${Ex}x-${Ey}y-1bin.profile
fix 9 CL   ave/chunk 1 2000000 2000000 cc1CL vx vy norm sample file vel-cl-${q}na-${T}K-${Ex}x-${Ey}y.profile
fix 10 NA  ave/chunk 1 2000000 2000000 cc1NA vx vy norm sample file vel-Na-${q}na-${T}K-${Ex}x-${Ey}y.profile
fix 11 water  ave/chunk 1 2000000 2000000 cc1Water vx vy norm sample file vel-water-${q}na-${T}K-${Ex}x-${Ey}y.profile

compute  cc12d flow chunk/atom bin/2d x 0.0 0.5 z 0.0 0.5
fix  12 flow ave/chunk 1 2000000 2000000 cc12d vx vy norm sample file vel-${q}na-${T}K-${Ex}x-${Ey}y-2d-bin.profile

restart         500000 restarting1-${q}na-${T}K-${Ex}x-${Ey}y restarting2-${q}na-${T}K-${Ex}x-${Ey}y

##########################
#electric field = volts/Angstrom
##########################

fix              Electic all efield  ${Ex} ${Ey} 0.0

thermo           250000

unfix FixNVT1

fix       FixNVT2 flow nvt temp $T $T 100 

compute  Temp5 flow temp/partial 1 0 1

fix_modify FixNVT2 temp Temp5

thermo_style	custom step temp c_Temp c_Temp5 press vol

#################################################################
#COMPUTE
#################################################################

compute	cct1 water chunk/atom molecule
compute	myChunk water dipole/chunk cct1
fix		1aa water ave/time 100000 1 100000 c_myChunk[*] file dipole-${q}na-${T}K-${Ex}x-${Ey}y.out mode vector


run              4000000  # 8 nano secend

run	         10000000 #20ns for equilibrium
